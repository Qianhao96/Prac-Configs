pipeline {
    environment {
        registry = "lqh19960723/prac_api"
        registryCredential = 'prac-api-dockerhub'
    }
    agent any
    stages {
        stage('Checkout API And Prac-Configs') {
            steps {
                script {
                    checkout scm
                }
                script {
                    cleanWs()
                    checkout([
                        $class: 'GitSCM',
                        branches: [[name: 'main']], // master
                        doGenerateSubmoduleConfigurations: false,
                        extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'prac-api']], 
                        extensions: [], 
                        submoduleCfg: [], 
                        userRemoteConfigs: [[credentialsId: 'Git-Personal-Access-Token', url: 'https://github.com/Qianhao96/Prac-API.git']]
                    ])
                }
            }
        }
        stage('Build Docker image') {
            steps {
                script {
                    pracApi = docker.build("prac-api", "--file deployment/Dockerfiles/Dockerfile.api .")
                }
            }
        }
        // stage('Push image to Dockerhub lqh Repo') {
        //     steps {
        //         script {
        //             docker.withRegistry(registry, registryCredential) {
        //                 pracApi.push("${env.BUILD_ID}")
        //                 pracApi.push("latest")
        //             }
        //         }
        //     }
        // }
        // stage ('BuildDocker API Image And Deploy To Remote server') {
        //     steps{
        //          sh 'sudo docker build -t prac_web_image -f /home/jenkins/deployment/Dockerfile.web .'
        //          //Do this later    
        //          //Looks like need to push the image to own docker hub repo and ssh to remote server and pull it down and run it.
        //     }
        // }
    }
}